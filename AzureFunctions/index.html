<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <!-- <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script> -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script> -->
</head>
<body>
    <div class="form-group mt-2 mx-2">
        <textarea name="textArea" id="textArea" cols="100" rows="10" class="form-control" placeholder="Phrase to search for similar articles"></textarea>
        <!-- <input id="textInput" type="text"> -->
    </div>
    <small >
        <div class="mx-2" id="messageBox">
        </div>
    </small>
    <div class="form-group mx-2 mt-2">   
        <input id="acceptButton" type="button" value="Find" class="btn btn-primary">
    </div>
    <div id="results" class="mx-2 mt-2">   

    </div>
</body>

<script>
    $(function(){
        $("#acceptButton").on("click",
        function(e){
            getResults();
        })
    })

    function getResults(){
        var text = $("#textArea").val();
        if(!text){
            $("#messageBox").text("Write phrase to to find connected wikipedia articles");
            return;
        }

        $("#results").html("");
        $("#messageBox").text("Waiting for response from server...")
        $.ajax({
            data:  {
                text: text
            },
            // headers: {
            //     "Access-Control-Allow-Origin":"*"
            // },
            url: "https://documentsimilarityenginefunctionsapp.azurewebsites.net/api/GetSimilarArticles",
            method: "GET",
            success: function(data, textStatus, xhr){
                console.log(xhr.status)
                if(xhr.status == '200'){
                    $("#messageBox").text("");
                    displayResults(data);
                }
                else{
                    $("#messageBox").text("Error occurred when getting results. " + data)
                }
                console.log(data);
            },
            error:function(data, textStatus, xhr){
                $("#messageBox").text("Error occurred when getting results. " + textStatus + data)
                console.log(data)
            },
        })
        // .done(function(data){
        //     console.log(data);
        // })
    }

    function displayResults(data){
        // console.log(data);
        // data=data.values()
        console.log(data);
        var resultsDiv = $("#results");
        resultsDiv.html("");
        data.forEach( e => {
            var url = e[0];
            var similarityPercent = e[1]*100
            resultsDiv.append("<div>" + similarityPercent.toFixed(1) + "% " + '<a href="' + url +'"">' + url +"</a></div>")

        });
    }
</script>